<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <title>Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨Ïûê</title>
  <style>
    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }
      .logout-btn {
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.4rem 0.8rem;
      }
      .login-box, form {
        width: 100%;
      }
      input, textarea {
        font-size: 0.95rem;
      }
      .notice {
        padding: 0.8rem;
      }
    }
  </style>
  
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f8f9fa;
    }
    h1 {
      color: #002244;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, textarea {
      padding: 0.5rem;
      font-size: 1rem;
      width: 100%;
    }
    button {
      padding: 0.6rem;
      background: #002244;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #004488;
    }
    .notice {
      background: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #002244;
      border-radius: 6px;
    }
    .notice-actions {
      margin-top: 0.5rem;
    }
    .notice-actions button {
      margin-right: 0.5rem;
    }

    .logout-btn {
  padding: 0.6rem 1rem;
  background-color: white;
  color: #002244;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: background 0.3s ease;
  margin-top: 0.5rem;
}


  .logout-btn:hover {
    background-color: #004488;
  }
  
  </style>

<style>
    .tabs {
      display: flex;
      margin-bottom: 1rem;
    }
    .tab-btn {
      flex: 1;
      padding: 0.6rem;
      cursor: pointer;
      background: #e0e0e0;
      border: none;
      font-weight: bold;
    }
    .tab-btn.active {
      background: #002244;
      color: white;
    }
    .tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}


.lang-btn-filter {
  padding: 0.4rem 1rem;
  background: #e0e0e0;
  border: none;
  font-weight: 600;
  cursor: pointer;
  border-radius: 4px;
}
.lang-btn-filter.active {
  background: #002244;
  color: white;
}

.notice-detail .content a {
  color: #0055aa;
  font-weight: 500;
  text-decoration: underline;
  word-break: break-all;
}

.admin-tabs-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(90deg, #002244, #004488);
  padding: 1rem 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  flex-wrap: wrap;
}

.admin-tabs {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.admin-tab {
  color: white;
  font-weight: 600;
  padding: 0.6rem 1.4rem;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  text-decoration: none;
  transition: background 0.3s ease, transform 0.2s ease;
}

.admin-tab:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
}

.admin-tab.active {
  background: white;
  color: #002244;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.logout-btn {
  padding: 0.6rem 1rem;
  background-color: white;
  color: #002244;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: background 0.3s ease;
  margin-top: 0.5rem;
}

.logout-btn:hover {
  background-color: #dde4ee;
}


    </style>
</head>

<body>
      
    <header class="admin-tabs-container">
        <nav class="admin-tabs">
          <a href="admin.html" class="admin-tab active">Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</a>
          <a href="admin-links.html" class="admin-tab">ÏûêÎ£åÏã§ Í¥ÄÎ¶¨</a>
          <a href="admin-contact.html" class="admin-tab">Ïó∞ÎùΩÏ≤ò Í¥ÄÎ¶¨</a>
        </nav>
        <button class="logout-btn" id="logout-btn">Î°úÍ∑∏ÏïÑÏõÉ</button>
      </header>
      
      

      
      
  <h1>Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</h1>

  <form id="notice-form">
    <input type="hidden" id="notice-id">
  
    <div class="tabs">      
        <button type="button" class="tab-btn" data-tab="en">English</button>
      <button type="button" class="tab-btn active" data-tab="ko">ÌïúÍµ≠Ïñ¥</button>
      <button type="button" class="tab-btn" data-tab="zh">‰∏≠Êñá</button>
    </div>

    <div class="tab-content" id="tab-en">
      <input id="title-en" name="title-en" placeholder="Title (English)" />
      <textarea id="content-en" placeholder="Content (English)"></textarea>
    </div>  

    <div class="tab-content active" id="tab-ko">
      <input id="title-ko" name="title-ko" placeholder="Ï†úÎ™© (ÌïúÍ∏Ä)" />
      <textarea id="content-ko" placeholder="ÎÇ¥Ïö© (ÌïúÍ∏Ä)"></textarea>
    </div>
  
    <div class="tab-content" id="tab-zh">
      <input id="title-zh" name="title-zh" placeholder="Ê†áÈ¢ò (Ï§ëÍµ≠Ïñ¥)" />
      <textarea id="content-zh" placeholder="ÂÜÖÂÆπ (Ï§ëÍµ≠Ïñ¥)"></textarea>
    </div>
  
    <input type="file" id="file-upload" multiple />
    <div id="preview" style="margin-top: 1rem;"></div>
  
    <button type="submit">Ï†ÄÏû•</button>
  </form>
  
  <div id="language-tabs" style="margin: 1rem 0; display: flex; gap: 1rem;">
    <button type="button" class="lang-btn-filter active" data-lang="ko">ÌïúÍµ≠Ïñ¥</button>
    <button type="button" class="lang-btn-filter" data-lang="en">English</button>
    <button type="button" class="lang-btn-filter" data-lang="zh">‰∏≠Êñá</button>
  </div>
  

  <section id="notice-list"></section>

  <script>
const uploadInput = document.getElementById('file-upload');
const previewArea = document.getElementById('preview');
    const contentField = document.getElementById('content-ko');
    const uploadedImages = [];
  
    // Î°úÍ∑∏Ïù∏ Í≤ÄÏÇ¨
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
      window.location.href = '/admin-login.html';
    }
  
    // Î°úÍ∑∏ÏïÑÏõÉ
    function logout() {
      localStorage.removeItem('token');
      alert("Î°úÍ∑∏ÏïÑÏõÉ ÎêòÏóàÏäµÎãàÎã§.");
      window.location.href = '/admin-login.html';
    }

    document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('logout-btn').addEventListener('click', () => {
    localStorage.removeItem('token');
    alert("Î°úÍ∑∏ÏïÑÏõÉ ÎêòÏóàÏäµÎãàÎã§.");
    window.location.href = '/admin-login.html';
  });
});

  
    // Í≥µÏßÄÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞
    async function loadNotices(q = "") {
      const res = await fetch('/api/notices?q=' + encodeURIComponent(q));
      const data = await res.json();
      const notices = data.notices || [];         // ‚úÖ Ï∂îÍ∞Ä
      const list = document.getElementById('notice-list');
      list.innerHTML = "";
      const lang = localStorage.getItem('siteLanguage') || 'ko';

notices.forEach(notice => {
    const title = notice.title?.[lang] || notice.title?.en || notice.title?.ko || notice.title?.zh || '(Ï†úÎ™© ÏóÜÏùå)';
const content = notice.content?.[lang] || notice.content?.en || notice.content?.ko || notice.title?.zh || '';

const titleEl = document.createElement("strong");
titleEl.textContent = title;

const timeEl = document.createElement("small");
timeEl.textContent = new Date(notice.createdAt).toLocaleString();

const contentEl = document.createElement("p");
contentEl.textContent = content;

const actionsDiv = document.createElement("div");
actionsDiv.className = "notice-actions";

const editBtn = document.createElement("button");
editBtn.textContent = "‚úè ÏàòÏ†ï";
editBtn.addEventListener("click", () => editNotice(notice));

const deleteBtn = document.createElement("button");
deleteBtn.textContent = "üóë ÏÇ≠Ï†ú";
deleteBtn.addEventListener("click", () => deleteNotice(notice._id));

actionsDiv.appendChild(editBtn);
actionsDiv.appendChild(deleteBtn);

const div = document.createElement("div");
div.className = "notice";
div.appendChild(titleEl);
div.appendChild(timeEl);
div.appendChild(contentEl);
div.appendChild(actionsDiv);

list.appendChild(div);

});

    }
  
    const searchInput = document.getElementById('search');
if (searchInput) {
  searchInput.addEventListener('input', () => {
    const q = searchInput.value;
    loadNotices(q);
  });
}

  
    // Í∏Ä ÏàòÏ†ï
    function editNotice(notice) {
      document.getElementById('notice-id').value = notice._id;
      document.getElementById('title-ko').value = notice.title.ko;
      document.getElementById('title-en').value = notice.title.en;
      document.getElementById('title-zh').value = notice.title.zh;
      document.getElementById('content-ko').value = notice.content.ko;
      document.getElementById('content-en').value = notice.content.en;
      document.getElementById('content-zh').value = notice.content.zh;
    }
  
    // Í∏Ä ÏÇ≠Ï†ú
    async function deleteNotice(id) {
      if (!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
      await fetch(`/api/notices/${id}`, { method: 'DELETE' });
      loadNotices();
    }
  
  
  // Drag & Drop
  previewArea.ondragover = (e) => {
    e.preventDefault();
    previewArea.style.border = '2px dashed #004488';
  };
  previewArea.ondragleave = (e) => {
    e.preventDefault();
    previewArea.style.border = '';
  };
  previewArea.ondrop = (e) => {
    e.preventDefault();
    previewArea.style.border = '';
    uploadInput.files = e.dataTransfer.files;
    uploadInput.dispatchEvent(new Event('change'));
  };

  // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú + ÏÇ≠Ï†ú Î≤ÑÌäº + Î≥∏Î¨∏ ÏÇΩÏûÖ
  uploadInput.addEventListener('change', async (e) => {
  const files = Array.from(e.target.files);
  const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
  const textarea = document.getElementById(`content-${activeTab}`);

  for (const file of files) {
    const formData = new FormData();
    formData.append('image', file); // ÏÑúÎ≤ÑÏóêÏÑ† 'image' ÌïÑÎìúÎ™Ö Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© Ï§ë

    const res = await fetch('/api/notices/upload', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('token')
      },
      body: formData
    });

    const data = await res.json();
    const fileUrl = data.url;
    const ext = file.name.split('.').pop().toLowerCase();

    let insertTag = '';
    if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) {
      insertTag = `<img src="${fileUrl}" alt="Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ">\n`;
    } else {
      insertTag = `<a href="${fileUrl}" download>${file.name}</a>\n`;
    }

    textarea.value += `\n${insertTag}`; // Î≥∏Î¨∏Ïóê ÏûêÎèô ÏÇΩÏûÖ

    // ÎØ∏Î¶¨Î≥¥Í∏∞ UIÎèÑ Íµ¨ÏÑ± (ÏÑ†ÌÉù)
    const wrapper = document.createElement('div');
    wrapper.style.marginBottom = '0.5rem';

    if (insertTag.includes('<img')) {
      const img = document.createElement('img');
      img.src = fileUrl;
      img.width = 100;
      img.style.borderRadius = '6px';
      img.style.boxShadow = '0 1px 4px rgba(0,0,0,0.1)';
      wrapper.appendChild(img);
    } else {
      const fileLink = document.createElement('a');
      fileLink.href = fileUrl;
      fileLink.textContent = file.name;
      fileLink.style.color = '#0055aa';
      fileLink.download = '';
      wrapper.appendChild(fileLink);
    }

    previewArea.appendChild(wrapper);
  }
});

  
    // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Í≥µÏßÄÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞
    loadNotices();

    // ÌÉ≠ Ï†ÑÌôò
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');

        // üî• ÌïµÏã¨: ÏÑ†ÌÉùÎêú Ïñ∏Ïñ¥Î°ú Í∞±Ïã†
        selectedLang = btn.dataset.tab;
    renderPostsFromServer(1); // Ïñ∏Ïñ¥ Î∞îÎÄåÏóàÏúºÎãà Î¶¨Ïä§Ìä∏ Îã§Ïãú Î°úÎî©
  });
});

// Ï†ÄÏû•Ïãú Ïñ∏Ïñ¥Î≥Ñ ÎÇ¥Ïö© ÎπÑÏñ¥ÏûàÏúºÎ©¥ null Ï≤òÎ¶¨
document.getElementById('notice-form').addEventListener('submit', async (e) => {
  e.preventDefault();

  const id = document.getElementById('notice-id').value;
  const langs = ['ko', 'en', 'zh'];
  let hasAtLeastOne = false;



  const currentTabLang = document.querySelector('.tab-btn.active').dataset.tab;

const titleInput = document.getElementById(`title-${currentTabLang}`);
const contentInput = document.getElementById(`content-${currentTabLang}`);

const title = titleInput?.value?.trim();
const content = contentInput?.value?.trim();

if (!title && !content) {
  alert("Ï†úÎ™© ÎòêÎäî ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
  return;
}

const payload = {
  title: { [currentTabLang]: title },
  content: { [currentTabLang]: content }
};


  const method = id ? 'PUT' : 'POST';
  const url = id ? `/api/notices/${id}` : '/api/notices';

  await fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });

  document.getElementById('notice-form').reset();
  document.getElementById('notice-id').value = '';

  // ‚úÖ Ï†ÄÏû•Îêú Ïñ∏Ïñ¥ ÌÉ≠ÏùÑ ÏÑ†ÌÉù ÏÉÅÌÉúÎ°ú Î∞òÏòÅ
  selectedLang = currentTabLang;

  // ÌÉ≠ Î≤ÑÌäº ÏãúÍ∞ÅÏ†ÅÏúºÎ°úÎèÑ ÌôúÏÑ±Ìôî Ï≤òÎ¶¨
  document.querySelectorAll('.lang-btn-filter').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === selectedLang);
  });

  // ‚úÖ ÏÑ†ÌÉù Ïñ∏Ïñ¥ Í∏∞Ï§ÄÏúºÎ°ú Í≥µÏßÄÏÇ¨Ìï≠ Îã§Ïãú Î†åÎçîÎßÅ
  renderPostsFromServer(1);
});



let selectedLang = 'ko'; // ‚úÖ Ï¥àÍ∏∞Í∞í: ÌïúÍµ≠Ïñ¥
document.addEventListener("DOMContentLoaded", () => {
  renderPostsFromServer(1); // ‚úÖ Í∏∞Î≥∏ Í≥µÏßÄÏÇ¨Ìï≠ Î°úÎî©
});


document.querySelectorAll('.lang-btn-filter').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.lang-btn-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedLang = btn.dataset.lang;
    renderPostsFromServer(1); // Ïñ∏Ïñ¥ Î≥ÄÍ≤Ω Ïãú Îã§Ïãú Î°úÎî©
  });
});

function renderPostsFromServer(page = 1, query = "") {
  fetch('/api/notices?q=' + encodeURIComponent(query))
    .then(res => res.json())
    .then(resData => {
  const allPosts = resData.notices || []; // ‚úÖ Í≥µÏßÄ Î∞∞Ïó¥ Ï∂îÏ∂ú
  const postsPerPage = 10;
  const start = (page - 1) * postsPerPage;
  const sliced = allPosts.slice(start, start + postsPerPage); // ‚úÖ Ïù¥Ï†ú Ï†ïÏÉÅ

      const listContainer = document.getElementById("notice-list");
      listContainer.innerHTML = "";

      sliced.forEach(post => {
        const title = post.title?.[selectedLang];
        const content = post.content?.[selectedLang];
        if (!title || !content) return;

        const div = document.createElement("div");
        div.className = "notice";
        div.innerHTML = `
          <strong>${title}</strong><br>
          <small>${new Date(post.createdAt).toLocaleString()}</small>
          <p>${content}</p>
          <div class="notice-actions">
            <button onclick='editNotice(${JSON.stringify(post)})'>‚úè ÏàòÏ†ï</button>
            <button onclick='deleteNotice("${post._id}")'>üóë ÏÇ≠Ï†ú</button>
          </div>
        `;
        listContainer.appendChild(div);
      });

      // renderPagination(allPosts.length, page); ‚Üí ÏõêÌïúÎã§Î©¥ Ï∂îÍ∞Ä Í∞ÄÎä•
    });
}

function insertImageToActiveContent(url) {
  // ÌòÑÏû¨ ÌôúÏÑ± ÌÉ≠ Ï∞æÍ∏∞
  const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
  const textarea = document.getElementById(`content-${activeTab}`);
  const imgTag = `<img src="${url}" alt="Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ">\n`;

  textarea.value += `\n${imgTag}`; // Í∏∞Ï°¥ ÎÇ¥Ïö© Îí§Ïóê Ïù¥ÎØ∏ÏßÄ ÏÇΩÏûÖ
}

  </script>
  
  


</body>
</html>
